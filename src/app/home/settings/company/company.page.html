<app-header
  [title]="title"
  [showMenu]="false"
  [showBack]="showBack"
  path="/dashboard/settings"
></app-header>

<ion-content fullscreen="true">
  <ion-grid class="container ion-padding" *ngIf="!isLoading else loadingT">
    <form
      (ngSubmit)="save()"
      name="company"
      [formGroup]="form"
      *ngIf="!onboarding"
    >
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Business Info</h4>
          <ion-text color="medium">
            <p>
              Add your business info that will be displayed on all your
              documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12" *ngIf="showAll">
              <ion-text>
                <h6>Upload Business Logo</h6>
              </ion-text>
              <app-img-upload
                [image]="company.logoUrl ? company.logoUrl : ''"
                [deleteRef]="company.logoRef ? company.logoRef : ''"
                path="company/{{company.id}}/logo"
                icon="cloud-upload-outline"
                (result)="uploadImage($event)"
              ></app-img-upload>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Business Name"
                placeholder="Cloudscaff Scaffold Management"
                controlName="name"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12" *ngIf="showAll">
              <app-input-reactive
                title="Registration Number"
                placeholder="Enter business registration number"
                [optional]="true"
                controlName="regNumber"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12" *ngIf="showAll">
              <app-input-reactive
                title="VAT Number"
                placeholder="Enter business VAT number"
                [optional]="true"
                controlName="vatNum"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Contact Info</h4>
          <ion-text color="medium">
            <p>
              Add your contact info that will be displayed on all your documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12">
              <app-input-reactive
                title="Email address"
                type="email"
                placeholder="info@cloudscaff.com"
                controlName="email"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Phone number"
                type="tel"
                placeholder="+14844731125"
                controlName="phone"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Business Address</h4>
          <ion-text color="medium">
            <p>
              Add your business address that will be displayed on all your
              documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12">
              <app-address-search
                (addressData)="updateAddress($event)"
              ></app-address-search>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Address"
                controlName="address"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Suburb"
                [optional]="true"
                controlName="suburb"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="State/City"
                controlName="city"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Zip Code"
                controlName="zip"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Country"
                controlName="country"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3" *ngIf="showAll">
        <ion-col sizeLg="6" size="12">
          <h4>Banking Details</h4>
          <ion-text color="medium">
            <p>
              Add your banking details that will be displayed on all your
              documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12">
              <app-input-reactive
                title="Bank Name"
                controlName="bankName"
                [optional]="true"
                [form]="form"
              ></app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Bank Account Number"
                controlName="accountNum"
                [optional]="true"
                type="number"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Branch Code"
                controlName="branchCode"
                [optional]="true"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Swift Code"
                controlName="swiftCode"
                [optional]="true"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>General Information</h4>
          <ion-text color="medium">
            <p>
              Choose your currency aswell as units of meaure that the platform
              and documents will display.
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12">
              <app-input-select-reactive
                title="Unit of Measure"
                controlName="measurement"
                [form]="form"
                [selectedText]="field('measurement').value.symbol"
              >
                <ion-select-option
                  [value]="measurement"
                  *ngFor="let measurement of measurements"
                >
                  {{measurement.symbol}} - {{measurement.name}}
                </ion-select-option>
              </app-input-select-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-select-reactive
                title="Unit of Mass"
                controlName="mass"
                [form]="form"
                [selectedText]="field('mass').value.symbol"
              >
                <ion-select-option [value]="mass" *ngFor="let mass of masses">
                  {{mass.symbol}} - {{mass.name}}
                </ion-select-option>
              </app-input-select-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-select-reactive
                title="Currency"
                controlName="currency"
                [form]="form"
                [selectedText]="field('currency').value.symbol"
              >
                <ion-select-option
                  [value]="currency"
                  *ngFor="let currency of currencies"
                >
                  {{currency.symbol}} - {{currency.name}}
                </ion-select-option>
              </app-input-select-reactive>
            </ion-col>
            <ion-col size="12" *ngIf="showAll">
              <app-input-reactive
                title="Sales Tax % (set to 0 if you want to exclude this)"
                controlName="salesTax"
                type="number"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12" *ngIf="showAll">
              <app-input-reactive
                title="VAT % (set to 0 if you want to exclude this)"
                controlName="vat"
                type="number"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12" *ngIf="showAll">
              <app-input-reactive
                title="GST % (set to 0 if you want to exclude this)"
                controlName="gst"
                type="number"
                [form]="form"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3" *ngIf="showAll">
        <ion-col sizeLg="6" size="12">
          <h4>Terminology</h4>
          <ion-text color="medium">
            <p>
              Choose your terminology for global names that the platform and
              documents will display.
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row formGroupName="terminology">
            <ion-col size="12">
              <app-input-reactive
                title="Term for a Scaffold"
                controlName="scaffold"
                [form]="field('terminology')"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Term for a Board"
                controlName="boards"
                [form]="field('terminology')"
              >
              </app-input-reactive>
            </ion-col>
            <ion-col size="12">
              <app-input-reactive
                title="Term for Hire"
                controlName="hire"
                [form]="field('terminology')"
              >
              </app-input-reactive>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3" *ngIf="showAll">
        <ion-col sizeLg="6" size="12">
          <h4>Intergrations</h4>
          <ion-text color="medium">
            <p>Choose a service to intergrate with.</p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <ion-row>
            <ion-col size="12" *ngIf="!loading && !company.tokens">
              <ion-button (click)="connect()"> Connect Xero </ion-button>
            </ion-col>
            <ion-col size="12" *ngIf="company.tokens">
              <ion-label>
                Xero Access Token: <br />
                <p class="bg-light rounded-lg p-3">
                  {{company.tokens.accessToken}}
                </p>
              </ion-label>
              <ion-label>
                Xero Refresh Token: <br />
                <p class="bg-light rounded-lg p-3">
                  {{company.tokens.refreshToken}}
                </p>
              </ion-label>
              <ion-label>
                Last Updated: <br />
                <p class="bg-light rounded-lg p-3">
                  {{company.tokens.lastUpdated.toDate?
                  company.tokens.lastUpdated.toDate() :
                  company.tokens.lastUpdated}}
                </p>
              </ion-label>
            </ion-col>
            <ion-col size="12" *ngIf="company.tokens">
              <ion-label>
                Tenant Name: <br />
                <p class="bg-light rounded-lg p-3">
                  {{company.tokens.tenantName}}
                </p>
              </ion-label>
              <ion-label>
                Tenant ID: <br />
                <p class="bg-light rounded-lg p-3">
                  {{company.tokens.tenantID}}
                </p>
              </ion-label>
              <ion-button
                (click)="connectTenant()"
                expand="block"
                fill="clear"
                shape="round"
              >
                Connect Tenant
              </ion-button>
              <!-- <ion-button
                (click)="getInvoices()"
                expand="block"
                fill="clear"
                shape="round"
              >
                get Invoicess
              </ion-button> -->
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row class="mt-4">
        <ion-progress-bar
          type="indeterminate"
          *ngIf="loading"
        ></ion-progress-bar>

        <ion-col size="12" class="text-end" *ngIf="!loading">
          <ion-button
            shape="round"
            color="success"
            type="submit"
            [disabled]="form.invalid"
            >Save Settings</ion-button
          >
        </ion-col>
      </ion-row>
    </form>
    <form
      (ngSubmit)="save()"
      name="company"
      [formGroup]="form"
      *ngIf="onboarding"
    >
      <ion-grid>
        <ion-row class="card-outline mb-3" *ngIf="page === 0">
          <ion-col sizeLg="6" size="12">
            <h4>Business Info</h4>
            <ion-text color="medium">
              <p>
                Add your business info that will be displayed on all your
                documents
              </p>
            </ion-text>
          </ion-col>
          <ion-col sizeLg="6" size="12">
            <ion-row>
              <ion-col size="12">
                <ion-text>
                  <h6>Upload Business Logo</h6>
                </ion-text>
                <app-img-upload
                  [image]="company.logoUrl ? company.logoUrl : ''"
                  [deleteRef]="company.logoRef ? company.logoRef : ''"
                  path="company/{{company.id}}/logo"
                  icon="cloud-upload-outline"
                  (result)="uploadImage($event)"
                ></app-img-upload>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Business Name"
                  placeholder="Cloudscaff Scaffold Management"
                  controlName="name"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12" *ngIf="showAll">
                <app-input-reactive
                  title="Registration Number"
                  placeholder="Enter business registration number"
                  [optional]="true"
                  controlName="regNumber"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12" *ngIf="showAll">
                <app-input-reactive
                  title="VAT Number"
                  placeholder="Enter business VAT number"
                  [optional]="true"
                  controlName="vatNum"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row class="card-outline mb-3" *ngIf="page === 1">
          <ion-col sizeLg="6" size="12">
            <h4>Contact Info</h4>
            <ion-text color="medium">
              <p>
                Add your contact info that will be displayed on all your
                documents
              </p>
            </ion-text>
          </ion-col>
          <ion-col sizeLg="6" size="12">
            <ion-row>
              <ion-col size="12">
                <app-input-reactive
                  title="Email address"
                  type="email"
                  placeholder="info@cloudscaff.com"
                  controlName="email"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Phone number"
                  type="tel"
                  placeholder="+14844731125"
                  controlName="phone"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row class="card-outline mb-3" *ngIf="page === 2">
          <ion-col sizeLg="6" size="12">
            <h4>Business Address</h4>
            <ion-text color="medium">
              <p>
                Add your business address that will be displayed on all your
                documents
              </p>
            </ion-text>
          </ion-col>
          <ion-col sizeLg="6" size="12">
            <ion-row>
              <ion-col size="12">
                <app-address-search
                  placeholder="Enter your address"
                  (addressData)="updateAddress($event)"
                ></app-address-search>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Address"
                  controlName="address"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Suburb"
                  [optional]="true"
                  controlName="suburb"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="State/City"
                  controlName="city"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Zip Code"
                  controlName="zip"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-reactive
                  title="Country"
                  controlName="country"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row class="card-outline mb-3" *ngIf="page === 3">
          <ion-col sizeLg="6" size="12">
            <h4>General Information</h4>
            <ion-text color="medium">
              <p>
                Choose your currency aswell as units of meaure that the platform
                and documents will display.
              </p>
            </ion-text>
          </ion-col>
          <ion-col sizeLg="6" size="12">
            <ion-row>
              <ion-col size="12">
                <app-input-select-reactive
                  title="Unit of Measure"
                  controlName="measurement"
                  [form]="form"
                  [selectedText]="field('measurement').value.symbol"
                >
                  <ion-select-option
                    [value]="measurement"
                    *ngFor="let measurement of measurements"
                  >
                    {{measurement.symbol}} - {{measurement.name}}
                  </ion-select-option>
                </app-input-select-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-select-reactive
                  title="Unit of Mass"
                  controlName="mass"
                  [form]="form"
                  [selectedText]="field('mass').value.symbol"
                >
                  <ion-select-option [value]="mass" *ngFor="let mass of masses">
                    {{mass.symbol}} - {{mass.name}}
                  </ion-select-option>
                </app-input-select-reactive>
              </ion-col>
              <ion-col size="12">
                <app-input-select-reactive
                  title="Currency"
                  controlName="currency"
                  [form]="form"
                  [selectedText]="field('currency').value.symbol"
                >
                  <ion-select-option
                    [value]="currency"
                    *ngFor="let currency of currencies"
                  >
                    {{currency.symbol}} - {{currency.name}}
                  </ion-select-option>
                </app-input-select-reactive>
              </ion-col>
              <ion-col size="12" *ngIf="showAll">
                <app-input-reactive
                  title="Sales Tax %"
                  controlName="salesTax"
                  type="number"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
              <ion-col size="12" *ngIf="showAll">
                <app-input-reactive
                  title="VAT %"
                  controlName="vat"
                  type="number"
                  [form]="form"
                >
                </app-input-reactive>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row class="mt-4">
          <ion-progress-bar
            type="indeterminate"
            *ngIf="loading"
          ></ion-progress-bar>

          <ion-col size="12" *ngIf="!loading">
            <ion-button
              class="float-end"
              shape="round"
              color="success"
              type="submit"
              *ngIf="page === 3"
            >
              Done
            </ion-button>
            <ion-button
              class="float-end"
              shape="round"
              *ngIf="page !== 3"
              (click)="next(1)"
            >
              Next
            </ion-button>
            <ion-button
              class="float-end"
              fill="outline"
              shape="round"
              *ngIf="page !== 3"
              (click)="next(1)"
            >
              Skip
            </ion-button>

            <ion-button
              class="float-start"
              shape="round"
              *ngIf="page !== 0"
              (click)="next(-1)"
            >
              Back
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </form>
  </ion-grid>
  <ng-template #loadingT>
    <div class="container py-5">
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Business Info</h4>
          <ion-text color="medium">
            <p>
              Your business name is displayed across many areas including on
              your all generated documents and messages to clients
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Contact Info</h4>
          <ion-text color="medium">
            <p>
              Add your contact info that will be displayed on all your documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Business Address</h4>
          <ion-text color="medium">
            <p>
              Add your business address that will be displayed on all your
              documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>Banking Details</h4>
          <ion-text color="medium">
            <p>
              Add your banking details that will be displayed on all your
              documents
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </ion-col>
      </ion-row>
      <ion-row class="card-outline mb-3">
        <ion-col sizeLg="6" size="12">
          <h4>General Information</h4>
          <ion-text color="medium">
            <p>
              Choose your currency aswell as units of meaure that the platform
              and documents will display.
            </p>
          </ion-text>
        </ion-col>
        <ion-col sizeLg="6" size="12">
          <app-skeleton-text></app-skeleton-text>
          <app-skeleton-text></app-skeleton-text>
        </ion-col>
      </ion-row>
    </div>
  </ng-template>
</ion-content>
