<ion-searchbar
  debounce="250"
  mode="ios"
  placeholder="Search by code, company, site address or total"
  (ionChange)="updateFilter($event)"
>
</ion-searchbar>
<ion-item lines="none" mode="ios">
  <ion-select
    #rows
    slot="start"
    placeholder="7"
    interface="popover"
    [value]="7"
  >
    <ion-select-option value="7">7</ion-select-option>
    <ion-select-option value="10">10</ion-select-option>
    <ion-select-option value="50">50</ion-select-option>
    <ion-select-option value="100">100</ion-select-option>
  </ion-select>
</ion-item>
<ngx-datatable
  class="bootstrap striped rounded-lg"
  [limit]="rows.value"
  [rows]="temp$ | async"
  [rowHeight]="'auto'"
  [columnMode]="'force'"
  [sortType]="sortType.multi"
  [headerHeight]="50"
  [footerHeight]="50"
  [selectionType]="selectionType.single"
  trackByProp="code"
  [scrollbarH]="true"
  (select)="onSelect($event)"
  [selected]="selected"
>
  <ngx-datatable-column
    name="Code"
    [checkboxable]="false"
    cellClass="my-auto"
  ></ngx-datatable-column>
  <ngx-datatable-column name="Customer" cellClass="my-auto">
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      {{ row.customer ? row.customer.name : row.customerName }}
    </ng-template></ngx-datatable-column
  >
  <ngx-datatable-column
    name="Site Address"
    cellClass="my-auto"
  ></ngx-datatable-column>

  <ngx-datatable-column
    name="Recieved Date"
    cellClass="text-center my-auto"
    headerClass="text-center"
  >
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      {{ value | dateFormat | date : "dd MMM yyyy" }}
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column
    name="Return Date"
    cellClass="text-center my-auto"
    headerClass="text-center"
  >
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      {{ value | dateFormat | date : "dd MMM yyyy" }}
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column
    name="Lead Score"
    prop="probability"
    cellClass="text-center my-auto"
    headerClass="text-center"
  >
  </ngx-datatable-column>
  <ngx-datatable-column
    name="Uploads"
    cellClass="text-center my-auto"
    headerClass="text-center"
  >
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <div>
        <ion-badge color="tertiary" mode="ios" *ngIf="value">{{
          value.length
        }}</ion-badge>
      </div>
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column
    name="Comment"
    cellClass="text-center my-auto"
    headerClass="text-center "
  >
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <ng-container *ngIf="row.estimate && row.estimate.comments">
        {{ row.estimate.comments[row.estimate.comments.length - 1].message }}
        <br />
        <br />
        {{
          row.estimate.comments[row.estimate.comments.length - 1].date.toDate()
            | dateFormat
            | date
        }}
      </ng-container>
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column
    name="Status"
    cellClass="text-end my-auto"
    headerClass="text-end"
  >
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <ion-badge [color]="getStatus(value)" mode="ios">{{ value }}</ion-badge>
    </ng-template>
  </ngx-datatable-column>
</ngx-datatable>
